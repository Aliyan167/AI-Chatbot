<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>HRBP AI Assistant</title>
<style>
body { background:#f4f6f9; font-family:Arial; }
.chat-container { width:650px; margin:40px auto; background:white;
padding:20px; border-radius:8px; }
#chat-box { height:400px; overflow-y:auto; border:1px solid #ddd;
padding:10px; background:#fafafa; }
.user { text-align:right; margin:10px; }
.bot { text-align:left; margin:10px; background:#eef2ff;
padding:8px; border-radius:5px; }
.input-area { display:flex; margin-top:10px; }
input { flex:1; padding:10px; }
button { padding:10px; background:#4a90e2; color:white; border:none; }
</style>
</head>
<body>

<div class="chat-container">
<h2>ðŸ¤– HRBP AI Assistant</h2>
<div id="chat-box"></div>
<div class="input-area">
<input id="message" placeholder="Ask an HR question..." />
<button onclick="send()">Send</button>
</div>
</div>

<script>
function getCookie(name) {
    let value = null;
    document.cookie.split(';').forEach(c => {
        c = c.trim();
        if (c.startsWith(name + '=')) {
            value = decodeURIComponent(c.substring(name.length + 1));
        }
    });
    return value;
}

async function send() {
    const input = document.getElementById("message");
    const msg = input.value.trim();
    if (!msg) return;

    add("You", msg);
    input.value = "";
    add("HRBP AI", "Thinking...");

    const res = await fetch("/chat/api/", {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            "X-CSRFToken": getCookie("csrftoken")
        },
        body: JSON.stringify({ message: msg })
    });

    const data = await res.json();
    document.getElementById("chat-box").lastChild.remove();

    add("HRBP AI", data.reply || data.error);
}

function add(sender, text) {
    const box = document.getElementById("chat-box");
    const div = document.createElement("div");
    div.className = sender === "You" ? "user" : "bot";
    div.innerHTML = `<b>${sender}</b><br>${text}`;
    box.appendChild(div);
    box.scrollTop = box.scrollHeight;
}
</script>

</body>
</html>
